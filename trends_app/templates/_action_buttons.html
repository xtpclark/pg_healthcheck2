{#
  Reusable action buttons macro for reports

  Parameters:
    - report_id: The ID of the report
    - report_type: Type of report ('health_check', 'generated_ai', 'trend_analysis')
    - db_technology: Database technology (postgres, kafka, cassandra, etc.) - optional
    - show_view: Show view button (default: true)
    - show_edit: Show edit button (default: true)
    - show_download: Show download button (default: true)
    - show_delete: Show delete button (default: false)
    - size: Button size ('sm', 'md', 'lg') - default: 'sm'
    - show_labels: Show text labels next to icons (default: false)
#}

{% macro action_buttons(report_id, report_type='health_check', db_technology=None, show_view=true, show_edit=true, show_download=true, show_delete=false, size='sm', show_labels=false) %}
<div class="action-buttons btn-group btn-group-{{ size }}" role="group" aria-label="Report actions">

    {# View Button #}
    {% if show_view %}
        <a href="{{ url_for('profile.view_report', report_type=report_type, report_id=report_id) }}"
           class="btn btn-outline-primary btn-{{ size }}"
           title="View Report"
           data-bs-toggle="tooltip"
           data-bs-placement="top">
            <i class="bi bi-eye"></i>
            {% if show_labels %} View{% endif %}
        </a>
    {% endif %}

    {# Edit Button - Privilege Controlled #}
    {% if show_edit %}
        {% set can_edit = false %}

        {# Check technology-specific edit privilege #}
        {% if db_technology %}
            {% set tech_capitalized = db_technology|capitalize %}
            {% if tech_capitalized == 'Postgres' %}
                {% set tech_capitalized = 'PostgreSQL' %}
            {% elif tech_capitalized == 'Opensearch' %}
                {% set tech_capitalized = 'OpenSearch' %}
            {% elif tech_capitalized == 'Clickhouse' %}
                {% set tech_capitalized = 'ClickHouse' %}
            {% elif tech_capitalized == 'Mongodb' %}
                {% set tech_capitalized = 'MongoDB' %}
            {% endif %}

            {% set edit_priv = 'Edit' + tech_capitalized + 'Reports' %}
            {% if current_user.has_privilege(edit_priv) or current_user.has_privilege('EditAllTechnologyReports') or current_user.has_privilege('EditReports') %}
                {% set can_edit = true %}
            {% endif %}
        {% elif current_user.has_privilege('EditReports') or current_user.has_privilege('EditAllTechnologyReports') %}
            {% set can_edit = true %}
        {% endif %}

        {% if can_edit %}
            <a href="{{ url_for('profile.edit_report', report_type=report_type, report_id=report_id) }}"
               class="btn btn-outline-warning btn-{{ size }}"
               title="Edit Report"
               data-bs-toggle="tooltip"
               data-bs-placement="top">
                <i class="bi bi-pencil-square"></i>
                {% if show_labels %} Edit{% endif %}
            </a>
        {% else %}
            <button class="btn btn-outline-secondary btn-{{ size }}"
                    disabled
                    title="Edit permission required"
                    data-bs-toggle="tooltip"
                    data-bs-placement="top">
                <i class="bi bi-pencil-square"></i>
                {% if show_labels %} Edit{% endif %}
            </button>
        {% endif %}
    {% endif %}

    {# Download Button - Privilege Controlled #}
    {% if show_download %}
        {% if current_user.has_privilege('DownloadReports') %}
            <a href="{{ url_for('main.download_report', report_type=report_type, report_id=report_id) }}"
               class="btn btn-outline-success btn-{{ size }}"
               title="Download Report"
               data-bs-toggle="tooltip"
               data-bs-placement="top"
               download>
                <i class="bi bi-download"></i>
                {% if show_labels %} Download{% endif %}
            </a>
        {% else %}
            <button class="btn btn-outline-secondary btn-{{ size }}"
                    disabled
                    title="Download permission required"
                    data-bs-toggle="tooltip"
                    data-bs-placement="top">
                <i class="bi bi-download"></i>
                {% if show_labels %} Download{% endif %}
            </button>
        {% endif %}
    {% endif %}

    {# Delete Button - Privilege Controlled #}
    {% if show_delete and current_user.has_privilege('DeleteReports') %}
        <button class="btn btn-outline-danger btn-{{ size }}"
                title="Delete Report"
                data-bs-toggle="tooltip"
                data-bs-placement="top"
                onclick="confirmDelete('{{ report_type }}', {{ report_id }})">
            <i class="bi bi-trash"></i>
            {% if show_labels %} Delete{% endif %}
        </button>
    {% endif %}

</div>

{# Delete confirmation modal (only included once per page) #}
{% if show_delete and not _delete_modal_included %}
    {% set _delete_modal_included = true %}
    <script>
        function confirmDelete(reportType, reportId) {
            if (confirm('Are you sure you want to delete this report? This action cannot be undone.')) {
                fetch(`/api/delete-report/${reportType}/${reportId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Report deleted successfully');
                        window.location.reload();
                    } else {
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => {
                    alert('Error deleting report: ' + error);
                });
            }
        }
    </script>
{% endif %}

{% endmacro %}
