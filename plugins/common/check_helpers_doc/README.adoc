= CheckContentBuilder - Summary for Team
:toc:

== What Is This?

`CheckContentBuilder` is a new **optional** helper class added to `plugins/common/check_helpers.py` that dramatically reduces boilerplate in health check modules.

== Critical: 100% Backward Compatible

**ZERO breaking changes:**

* ‚úÖ All existing checks work unchanged
* ‚úÖ All existing helper functions unchanged  
* ‚úÖ Purely additive - appended to end of check_helpers.py
* ‚úÖ Opt-in only - use when you want
* ‚úÖ Can mix with existing patterns

## Line Count Comparison

=== Kafka JVM Check Example

[cols="1,1,1"]
|===
|Metric |BEFORE |AFTER

|Total lines
|605
|~300 (50% reduction!)

|Admonition blocks
|100+ lines manual
|Single method calls

|Table building
|50+ lines manual
|Clean table methods

|Recommendations
|30+ lines manual
|Structured dict or list
|===

=== The Typing Reduction

**BEFORE (Manual):**
[source,python]
----
adoc_content = ["=== Title", ""]
adoc_content.append("Checking...")
adoc_content.append("")
adoc_content.append("[IMPORTANT]")
adoc_content.append("====")
adoc_content.append("Critical issue!")
adoc_content.append("====")
adoc_content.append("")
adoc_content.append("==== Summary")
adoc_content.append("|===")
adoc_content.append("|Broker|Usage")
adoc_content.append("|1|95%")
adoc_content.append("|===")
adoc_content.append("")
return "\n".join(adoc_content), structured_data
----

**AFTER (Builder):**
[source,python]
----
builder = CheckContentBuilder(connector.formatter)
builder.h3("Title")
builder.para("Checking...")
builder.critical("Critical issue!")
builder.h4("Summary")
builder.table(data)
return builder.build(), structured_data
----

**Result:** ~60% fewer lines for the same output!

== Files Provided

=== 1. check_helpers_enhanced.py

The enhanced `check_helpers.py` with `CheckContentBuilder` class appended to the end.

**To install:**
[source,bash]
----
cp check_helpers_enhanced.py plugins/common/check_helpers.py
----

=== 2. example_jvm_check_refactored.py

Shows the complex Kafka JVM check refactored with CheckContentBuilder.

**Key improvements:**
* Critical issues: 10+ lines ‚Üí 1 method call
* Tables with indicators: 30+ lines ‚Üí 1 method call  
* Recommendations: 30+ lines ‚Üí 1 structured dict
* 50% overall line reduction

=== 3. example_simple_checks_refactored.py

Shows simpler checks (Postgres, Cassandra) and how to mix old/new patterns.

**Key improvements:**
* No more manual list management
* Cleaner admonition syntax
* Works with existing `safe_execute_query()` and other helpers

=== 4. CheckContentBuilder_Usage_Guide.adoc

Comprehensive guide covering:
* Quick start examples
* Method reference
* Common patterns
* Migration guide (optional)
* Best practices
* FAQ

== Quick Start

=== Basic Example

[source,python]
----
from plugins.common.check_helpers import CheckContentBuilder

def run_my_check(connector, settings):
    builder = CheckContentBuilder(connector.formatter)
    structured_data = {}
    
    builder.h3("My Check")
    builder.para("Description...")
    
    if problem:
        builder.critical("Issue found!")
    
    builder.h4("Summary")
    builder.table(data)
    builder.recs(["Fix this", "Do that"])
    
    return builder.build(), structured_data
----

=== Method Cheat Sheet

[source,python]
----
# Headers
builder.h3("Title")              # === Title
builder.h4("Subtitle")           # ==== Subtitle

# Text
builder.para("Text")             # Paragraph + blank line
builder.text("Text")             # Text without blank

# Admonitions (short names!)
builder.note("Info")             # [NOTE]
builder.tip("Tip")               # [TIP]
builder.warning("Warning")       # [WARNING]
builder.critical("Critical")     # [IMPORTANT]
builder.error("Error")           # [CAUTION]

# Structured issues
builder.critical_issue(
    "Title",
    {"Key": "Value", "Key2": "Value2"}
)

# Tables
builder.table(data)              # List of dicts
builder.dict_table(dict)         # Two-column from dict
builder.table_with_indicators()  # Auto üî¥/‚ö†Ô∏è indicators

# Recommendations
builder.recs(["Rec 1", "Rec 2"])           # Simple list
builder.recs({                              # Structured by priority
    "critical": [...],
    "high": [...],
    "general": [...]
})

# Status messages
builder.success()                # ‚úÖ success
builder.skip("reason")           # Skip note

# Pre-formatted content (from existing helpers!)
builder.add(formatted_string)    # Add any pre-formatted content
builder.add_lines(list)          # Add list of lines

# Build
return builder.build(), structured_data
----

== Key Features

=== 1. Minimal Typing

Super short method names reduce typing:
* `h3()`, `h4()` - headers
* `note()`, `tip()`, `warning()`, `critical()`, `error()` - admonitions
* `para()`, `text()` - text content
* `table()`, `recs()` - tables and recommendations
* `add()` - pre-formatted content

=== 2. No List Management

**BEFORE:**
[source,python]
----
adoc_content = []
adoc_content.append("text")
adoc_content.extend(more_lines)
return "\n".join(adoc_content)
----

**AFTER:**
[source,python]
----
builder = CheckContentBuilder()
builder.text("text")
builder.add_lines(more_lines)
return builder.build()
----

=== 3. Works with Existing Helpers

[source,python]
----
# Existing helpers still work!
success, formatted, raw = safe_execute_query(...)
builder.add(formatted)  # Add pre-formatted output

header = format_check_header(...)
builder.add_lines(header)  # Add pre-formatted header
----

=== 4. Fluent/Chainable API

[source,python]
----
# Can chain for simple cases
builder.h3("Title").para("Text").note("Note")

# Or traditional style
builder.h3("Title")
builder.para("Text")
builder.note("Note")
----

=== 5. Structured Issue Blocks

Perfect for Kafka JVM check patterns:

[source,python]
----
builder.critical_issue(
    "Critical Heap Usage",
    {
        "Broker": "1 (192.168.1.113)",
        "Heap": "95.3% (threshold: 90%)",
        "Status": "CRITICAL"
    }
)
----

Output:
----
[IMPORTANT]
====
**Critical Heap Usage**

* **Broker:** 1 (192.168.1.113)
* **Heap:** 95.3% (threshold: 90%)
* **Status:** CRITICAL
====
----

=== 6. Tables with Auto-Indicators

[source,python]
----
builder.table_with_indicators(
    headers=["Broker", "CPU %", "Memory %"],
    rows=[[1, 95, 78], [2, 65, 55]],
    indicator_col=1,  # CPU column
    warning_threshold=70,
    critical_threshold=90
)
----

Automatically adds üî¥ for critical, ‚ö†Ô∏è for warning.

=== 7. Structured Recommendations

[source,python]
----
builder.recs({
    "critical": [
        "Immediate: Increase heap",
        "Risk: May crash"
    ],
    "high": [
        "Plan optimization",
        "Review settings"
    ],
    "general": [
        "Best practice 1",
        "Best practice 2"
    ]
})
----

Output includes priority indicators (üî¥, ‚ö†Ô∏è, üìã).

== Adoption Strategy

=== Recommended Approach

1. **Install:** Copy `check_helpers_enhanced.py` to `plugins/common/check_helpers.py`
2. **Verify:** Run existing tests - all should pass (zero breaking changes)
3. **Start small:** Use in next new check you write
4. **Expand:** Refactor existing checks when touching them anyway
5. **No pressure:** Never need to migrate everything - mix forever

=== When to Use

**Good candidates:**
* New checks you're writing
* Checks with lots of manual admonitions (like Kafka JVM)
* Checks with complex table formatting
* Checks you're refactoring for other reasons

**Not necessary:**
* Simple checks that already work fine
* Checks that rarely change
* When team prefers existing pattern

=== Migration is Optional

**You do NOT need to migrate existing checks!**

They will work forever unchanged. Only use CheckContentBuilder when:
* Writing new checks
* You want cleaner code
* Team agrees it's helpful

== Testing

=== Verify Installation

[source,python]
----
from plugins.common.check_helpers import CheckContentBuilder

# Should work without errors
builder = CheckContentBuilder()
builder.h3("Test").note("Testing")
output = builder.build()
print(output)
----

=== Run Existing Tests

[source,bash]
----
# All existing tests should pass
pytest tests/
----

=== Write New Tests

See examples in `example_*.py` files for patterns to test.

== Support

=== Questions?

1. Read the comprehensive guide: `CheckContentBuilder_Usage_Guide.adoc`
2. See examples: `example_jvm_check_refactored.py`, `example_simple_checks_refactored.py`
3. Ask the team

=== Issues?

If something doesn't work:
1. Verify you're using `check_helpers_enhanced.py`
2. Check that existing code still works (backward compatibility)
3. Review examples for correct usage patterns

== Summary

**CheckContentBuilder reduces check code by ~50% through:**

* ‚úÖ Short method names
* ‚úÖ No list management
* ‚úÖ Fluent API
* ‚úÖ Structured patterns
* ‚úÖ Auto-formatting

**While maintaining:**

* ‚úÖ 100% backward compatibility
* ‚úÖ Works with all existing helpers
* ‚úÖ Optional - use when you want
* ‚úÖ Can mix old and new patterns

**Your team will type less and write cleaner checks!** üöÄ
