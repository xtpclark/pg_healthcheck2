{
  "broker_unavailable": {
    "metric_keywords": ["broker_availability", "brokers", "status"],
    "rules": [
      {
        "expression": "data.get('status') == 'unavailable'",
        "level": "critical",
        "score": 10,
        "reasoning": "Broker {data.get('broker_id', 'unknown')} at {data.get('host', 'unknown')}:{data.get('port', 'unknown')} is unavailable.",
        "recommendations": [
          "IMMEDIATE ACTION: Check if the broker process is running.",
          "Check broker logs for errors (OOM, disk full, crashes).",
          "Verify network connectivity to the broker.",
          "If broker is down, restart it immediately to restore replication.",
          "Check disk space - full disks will cause brokers to stop responding."
        ]
      }
    ]
  },
  "controller_unavailable": {
    "metric_keywords": ["broker_availability", "controller_available"],
    "rules": [
      {
        "expression": "data.get('controller_available') == False and data.get('controller_id', -1) != -1",
        "level": "critical",
        "score": 10,
        "reasoning": "Controller broker (ID: {data.get('controller_id', 'unknown')}) is unavailable.",
        "recommendations": [
          "CRITICAL: The controller manages partition leadership and cluster metadata.",
          "A new controller will be elected automatically, but verify the election completes.",
          "Bring the failed controller broker back online as soon as possible.",
          "Check for controller election storms in the logs."
        ]
      }
    ]
  },
  "reduced_broker_count": {
    "metric_keywords": ["broker_availability", "unavailable_count"],
    "rules": [
      {
        "expression": "data.get('unavailable_count', 0) > 0",
        "level": "critical",
        "score": 9,
        "reasoning": "{data.get('unavailable_count', 0)} of {data.get('count', 0)} brokers are unavailable.",
        "recommendations": [
          "Cluster capacity is reduced, increasing load on remaining brokers.",
          "Under-replicated partitions are likely present.",
          "Data loss risk if additional brokers fail.",
          "Restore unavailable brokers immediately."
        ]
      }
    ]
  }
}
